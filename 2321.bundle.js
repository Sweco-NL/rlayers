(self.webpackChunkrlayers=self.webpackChunkrlayers||[]).push([[2321],{6368:(e,t,i)=>{"use strict";const r=i(61),s=Symbol("max"),n=Symbol("length"),o=Symbol("lengthCalculator"),a=Symbol("allowStale"),l=Symbol("maxAge"),h=Symbol("dispose"),c=Symbol("noDisposeOnSet"),u=Symbol("lruList"),f=Symbol("cache"),g=Symbol("updateAgeOnGet"),d=()=>1,p=(e,t,i)=>{const r=e[f].get(t);if(r){const t=r.value;if(y(e,t)){if(m(e,r),!e[a])return}else i&&(e[g]&&(r.value.now=Date.now()),e[u].unshiftNode(r));return t.value}},y=(e,t)=>{if(!t||!t.maxAge&&!e[l])return!1;const i=Date.now()-t.now;return t.maxAge?i>t.maxAge:e[l]&&i>e[l]},w=e=>{if(e[n]>e[s])for(let t=e[u].tail;e[n]>e[s]&&null!==t;){const i=t.prev;m(e,t),t=i}},m=(e,t)=>{if(t){const i=t.value;e[h]&&e[h](i.key,i.value),e[n]-=i.length,e[f].delete(i.key),e[u].removeNode(t)}};class b{constructor(e,t,i,r,s){this.key=e,this.value=t,this.length=i,this.now=r,this.maxAge=s||0}}const S=(e,t,i,r)=>{let s=i.value;y(e,s)&&(m(e,i),e[a]||(s=void 0)),s&&t.call(r,s.value,s.key,e)};e.exports=class{constructor(e){if("number"==typeof e&&(e={max:e}),e||(e={}),e.max&&("number"!=typeof e.max||e.max<0))throw new TypeError("max must be a non-negative number");this[s]=e.max||1/0;const t=e.length||d;if(this[o]="function"!=typeof t?d:t,this[a]=e.stale||!1,e.maxAge&&"number"!=typeof e.maxAge)throw new TypeError("maxAge must be a number");this[l]=e.maxAge||0,this[h]=e.dispose,this[c]=e.noDisposeOnSet||!1,this[g]=e.updateAgeOnGet||!1,this.reset()}set max(e){if("number"!=typeof e||e<0)throw new TypeError("max must be a non-negative number");this[s]=e||1/0,w(this)}get max(){return this[s]}set allowStale(e){this[a]=!!e}get allowStale(){return this[a]}set maxAge(e){if("number"!=typeof e)throw new TypeError("maxAge must be a non-negative number");this[l]=e,w(this)}get maxAge(){return this[l]}set lengthCalculator(e){"function"!=typeof e&&(e=d),e!==this[o]&&(this[o]=e,this[n]=0,this[u].forEach((e=>{e.length=this[o](e.value,e.key),this[n]+=e.length}))),w(this)}get lengthCalculator(){return this[o]}get length(){return this[n]}get itemCount(){return this[u].length}rforEach(e,t){t=t||this;for(let i=this[u].tail;null!==i;){const r=i.prev;S(this,e,i,t),i=r}}forEach(e,t){t=t||this;for(let i=this[u].head;null!==i;){const r=i.next;S(this,e,i,t),i=r}}keys(){return this[u].toArray().map((e=>e.key))}values(){return this[u].toArray().map((e=>e.value))}reset(){this[h]&&this[u]&&this[u].length&&this[u].forEach((e=>this[h](e.key,e.value))),this[f]=new Map,this[u]=new r,this[n]=0}dump(){return this[u].map((e=>!y(this,e)&&{k:e.key,v:e.value,e:e.now+(e.maxAge||0)})).toArray().filter((e=>e))}dumpLru(){return this[u]}set(e,t,i){if((i=i||this[l])&&"number"!=typeof i)throw new TypeError("maxAge must be a number");const r=i?Date.now():0,a=this[o](t,e);if(this[f].has(e)){if(a>this[s])return m(this,this[f].get(e)),!1;const o=this[f].get(e).value;return this[h]&&(this[c]||this[h](e,o.value)),o.now=r,o.maxAge=i,o.value=t,this[n]+=a-o.length,o.length=a,this.get(e),w(this),!0}const g=new b(e,t,a,r,i);return g.length>this[s]?(this[h]&&this[h](e,t),!1):(this[n]+=g.length,this[u].unshift(g),this[f].set(e,this[u].head),w(this),!0)}has(e){if(!this[f].has(e))return!1;const t=this[f].get(e).value;return!y(this,t)}get(e){return p(this,e,!0)}peek(e){return p(this,e,!1)}pop(){const e=this[u].tail;return e?(m(this,e),e.value):null}del(e){m(this,this[f].get(e))}load(e){this.reset();const t=Date.now();for(let i=e.length-1;i>=0;i--){const r=e[i],s=r.e||0;if(0===s)this.set(r.k,r.v);else{const e=s-t;e>0&&this.set(r.k,r.v,e)}}}prune(){this[f].forEach(((e,t)=>p(this,t,!1)))}}},362:e=>{"use strict";e.exports=function(e){e.prototype[Symbol.iterator]=function*(){for(let e=this.head;e;e=e.next)yield e.value}}},61:(e,t,i)=>{"use strict";function r(e){var t=this;if(t instanceof r||(t=new r),t.tail=null,t.head=null,t.length=0,e&&"function"==typeof e.forEach)e.forEach((function(e){t.push(e)}));else if(arguments.length>0)for(var i=0,s=arguments.length;i<s;i++)t.push(arguments[i]);return t}function s(e,t,i){var r=t===e.head?new a(i,null,t,e):new a(i,t,t.next,e);return null===r.next&&(e.tail=r),null===r.prev&&(e.head=r),e.length++,r}function n(e,t){e.tail=new a(t,e.tail,null,e),e.head||(e.head=e.tail),e.length++}function o(e,t){e.head=new a(t,null,e.head,e),e.tail||(e.tail=e.head),e.length++}function a(e,t,i,r){if(!(this instanceof a))return new a(e,t,i,r);this.list=r,this.value=e,t?(t.next=this,this.prev=t):this.prev=null,i?(i.prev=this,this.next=i):this.next=null}e.exports=r,r.Node=a,r.create=r,r.prototype.removeNode=function(e){if(e.list!==this)throw new Error("removing node which does not belong to this list");var t=e.next,i=e.prev;return t&&(t.prev=i),i&&(i.next=t),e===this.head&&(this.head=t),e===this.tail&&(this.tail=i),e.list.length--,e.next=null,e.prev=null,e.list=null,t},r.prototype.unshiftNode=function(e){if(e!==this.head){e.list&&e.list.removeNode(e);var t=this.head;e.list=this,e.next=t,t&&(t.prev=e),this.head=e,this.tail||(this.tail=e),this.length++}},r.prototype.pushNode=function(e){if(e!==this.tail){e.list&&e.list.removeNode(e);var t=this.tail;e.list=this,e.prev=t,t&&(t.next=e),this.tail=e,this.head||(this.head=e),this.length++}},r.prototype.push=function(){for(var e=0,t=arguments.length;e<t;e++)n(this,arguments[e]);return this.length},r.prototype.unshift=function(){for(var e=0,t=arguments.length;e<t;e++)o(this,arguments[e]);return this.length},r.prototype.pop=function(){if(this.tail){var e=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,e}},r.prototype.shift=function(){if(this.head){var e=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,e}},r.prototype.forEach=function(e,t){t=t||this;for(var i=this.head,r=0;null!==i;r++)e.call(t,i.value,r,this),i=i.next},r.prototype.forEachReverse=function(e,t){t=t||this;for(var i=this.tail,r=this.length-1;null!==i;r--)e.call(t,i.value,r,this),i=i.prev},r.prototype.get=function(e){for(var t=0,i=this.head;null!==i&&t<e;t++)i=i.next;if(t===e&&null!==i)return i.value},r.prototype.getReverse=function(e){for(var t=0,i=this.tail;null!==i&&t<e;t++)i=i.prev;if(t===e&&null!==i)return i.value},r.prototype.map=function(e,t){t=t||this;for(var i=new r,s=this.head;null!==s;)i.push(e.call(t,s.value,this)),s=s.next;return i},r.prototype.mapReverse=function(e,t){t=t||this;for(var i=new r,s=this.tail;null!==s;)i.push(e.call(t,s.value,this)),s=s.prev;return i},r.prototype.reduce=function(e,t){var i,r=this.head;if(arguments.length>1)i=t;else{if(!this.head)throw new TypeError("Reduce of empty list with no initial value");r=this.head.next,i=this.head.value}for(var s=0;null!==r;s++)i=e(i,r.value,s),r=r.next;return i},r.prototype.reduceReverse=function(e,t){var i,r=this.tail;if(arguments.length>1)i=t;else{if(!this.tail)throw new TypeError("Reduce of empty list with no initial value");r=this.tail.prev,i=this.tail.value}for(var s=this.length-1;null!==r;s--)i=e(i,r.value,s),r=r.prev;return i},r.prototype.toArray=function(){for(var e=new Array(this.length),t=0,i=this.head;null!==i;t++)e[t]=i.value,i=i.next;return e},r.prototype.toArrayReverse=function(){for(var e=new Array(this.length),t=0,i=this.tail;null!==i;t++)e[t]=i.value,i=i.prev;return e},r.prototype.slice=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var i=new r;if(t<e||t<0)return i;e<0&&(e=0),t>this.length&&(t=this.length);for(var s=0,n=this.head;null!==n&&s<e;s++)n=n.next;for(;null!==n&&s<t;s++,n=n.next)i.push(n.value);return i},r.prototype.sliceReverse=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var i=new r;if(t<e||t<0)return i;e<0&&(e=0),t>this.length&&(t=this.length);for(var s=this.length,n=this.tail;null!==n&&s>t;s--)n=n.prev;for(;null!==n&&s>e;s--,n=n.prev)i.push(n.value);return i},r.prototype.splice=function(e,t,...i){e>this.length&&(e=this.length-1),e<0&&(e=this.length+e);for(var r=0,n=this.head;null!==n&&r<e;r++)n=n.next;var o=[];for(r=0;n&&r<t;r++)o.push(n.value),n=this.removeNode(n);for(null===n&&(n=this.tail),n!==this.head&&n!==this.tail&&(n=n.prev),r=0;r<i.length;r++)n=s(this,n,i[r]);return o},r.prototype.reverse=function(){for(var e=this.head,t=this.tail,i=e;null!==i;i=i.prev){var r=i.prev;i.prev=i.next,i.next=r}return this.head=t,this.tail=e,this};try{i(362)(r)}catch(e){}},7840:e=>{function t(e,t){const i=new RegExp(t,"g"),r=e.match(i);return r?r.length:0}e.exports=t,e.exports.default=t},4635:(e,t,i)=>{const r=i(9622),s=i(2566),n=i(7840);function o(e,t,i){const o=i&&i.debug||!1,a=!(i&&!1===typeof i.nested),l=i&&i.startIndex||0;o&&console.log("[xml-utils] starting findTagByName with",t," and ",i);const h=r(e,`<${t}[ >/]`,l);if(o&&console.log("[xml-utils] start:",h),-1===h)return;const c=e.slice(h+t.length);let u=s(c,"^[^<]*[ /]>",0);const f=-1!==u&&"/"===c[u-1];if(o&&console.log("[xml-utils] selfClosing:",f),!1===f)if(a){let e=0,i=1,r=0;for(;-1!==(u=s(c,"[ /]"+t+">",e));){const s=c.substring(e,u+1);if(i+=n(s,"<"+t),r+=n(s,"/"+t+">"),r>=i)break;e=u}}else u=s(c,"[ /]"+t+">",0);const g=h+t.length+u+1;if(o&&console.log("[xml-utils] end:",g),-1===g)return;const d=e.slice(h,g);let p;return p=f?null:d.slice(d.indexOf(">")+1,d.lastIndexOf("<")),{inner:p,outer:d,start:h,end:g}}e.exports=o,e.exports.default=o},8602:(e,t,i)=>{const r=i(4635);function s(e,t,i){const s=[],n=i&&i.debug||!1,o=!i||"boolean"!=typeof i.nested||i.nested;let a,l=i&&i.startIndex||0;for(;a=r(e,t,{debug:n,startIndex:l});)l=o?a.start+1+t.length:a.end,s.push(a);return n&&console.log("findTagsByName found",s.length,"tags"),s}e.exports=s,e.exports.default=s},8330:e=>{function t(e,t,i){const r=i&&i.debug||!1;r&&console.log("getting "+t+" in "+e);const s="object"==typeof e?e.outer:e,n=`${t}\\="([^"]*)"`;r&&console.log("pattern:",n);const o=new RegExp(n).exec(s);if(r&&console.log("match:",o),o)return o[1]}e.exports=t,e.exports.default=t},2566:e=>{function t(e,t,i){const r=new RegExp(t).exec(e.slice(i));return r?i+r.index+r[0].length-1:-1}e.exports=t,e.exports.default=t},9622:e=>{function t(e,t,i){const r=new RegExp(t).exec(e.slice(i));return r?i+r.index:-1}e.exports=t,e.exports.default=t},2499:(e,t,i)=>{"use strict";i.d(t,{Ie:()=>l,It:()=>n,L:()=>r,L5:()=>c,P1:()=>f,Qb:()=>u,pd:()=>h,sf:()=>a});const r={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams",50674:"LercParameters"},s={};for(const e in r)r.hasOwnProperty(e)&&(s[r[e]]=parseInt(e,10));const n=[s.BitsPerSample,s.ExtraSamples,s.SampleFormat,s.StripByteCounts,s.StripOffsets,s.StripRowCounts,s.TileByteCounts,s.TileOffsets,s.SubIFDs],o={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",13:"IFD",16:"LONG8",17:"SLONG8",18:"IFD8"},a={};for(const e in o)o.hasOwnProperty(e)&&(a[o[e]]=parseInt(e,10));const l={WhiteIsZero:0,BlackIsZero:1,RGB:2,Palette:3,TransparencyMask:4,CMYK:5,YCbCr:6,CIELab:8,ICCLab:9},h={Unspecified:0,Assocalpha:1,Unassalpha:2},c={Version:0,AddCompression:1},u={None:0,Deflate:1},f={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"},g={};for(const e in f)f.hasOwnProperty(e)&&(g[f[e]]=parseInt(e,10))},2321:(e,t,i)=>{"use strict";i.d(t,{Z:()=>Ot});var r=i(349),s=i(5487),n=i(8815),o=i(7302),a=i(7195),l=i(7248),h=i(8634),c=i(4187),u=i(6885),f=i(4307);class g extends o.Z{constructor(e){const t=void 0===e.projection?"EPSG:3857":e.projection;let i=e.tileGrid;void 0===i&&t&&(i=(0,l.dl)({extent:(0,l.Tl)(t),maxResolution:e.maxResolution,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize})),super({cacheSize:.1,attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:t,tileGrid:i,opaque:e.opaque,state:e.state,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate}),this.gutter_=void 0!==e.gutter?e.gutter:0,this.tileSize_=e.tileSize?(0,f.Pq)(e.tileSize):null,this.tileSizes_=null,this.tileLoadingKeys_={},this.loader_=e.loader,this.handleTileChange_=this.handleTileChange_.bind(this),this.bandCount=void 0===e.bandCount?4:e.bandCount}setTileSizes(e){this.tileSizes_=e}getTileSize(e){if(this.tileSizes_)return this.tileSizes_[e];if(this.tileSize_)return this.tileSize_;const t=this.getTileGrid();return t?(0,f.Pq)(t.getTileSize(e)):[256,256]}getGutterForProjection(e){return this.gutter_}setLoader(e){this.loader_=e}getTile(e,t,i,n,o){const a=this.getTileSize(e),l=(0,h.lg)(e,t,i);if(this.tileCache.containsKey(l))return this.tileCache.get(l);const c=this.loader_,f=Object.assign({tileCoord:[e,t,i],loader:function(){return(0,u.Vi)((function(){return c(e,t,i)}))},size:a},this.tileOptions),g=new r.Z(f);return g.key=this.getKey(),g.addEventListener(s.Z.CHANGE,this.handleTileChange_),this.tileCache.set(l,g),g}handleTileChange_(e){const t=e.target,i=(0,c.sq)(t),r=t.getState();let s;r==a.Z.LOADING?(this.tileLoadingKeys_[i]=!0,s=n.Z.TILELOADSTART):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],s=r==a.Z.ERROR?n.Z.TILELOADERROR:r==a.Z.LOADED?n.Z.TILELOADEND:void 0),s&&this.dispatchEvent(new o.s(s,t))}}const d=g;var p=i(8738),y=i(2499);const w=new Map;function m(e,t){Array.isArray(e)||(e=[e]),e.forEach((e=>w.set(e,t)))}async function b(e){const t=w.get(e.Compression);if(!t)throw new Error(`Unknown compression method identifier: ${e.Compression}`);return new(await t())(e)}m([void 0,1],(()=>i.e(3321).then(i.bind(i,3321)).then((e=>e.default)))),m(5,(()=>i.e(8672).then(i.bind(i,8672)).then((e=>e.default)))),m(6,(()=>{throw new Error("old style JPEG compression is not supported.")})),m(7,(()=>i.e(9347).then(i.bind(i,9347)).then((e=>e.default)))),m([8,32946],(()=>Promise.all([i.e(7885),i.e(5522)]).then(i.bind(i,5522)).then((e=>e.default)))),m(32773,(()=>i.e(7411).then(i.bind(i,7411)).then((e=>e.default)))),m(34887,(()=>Promise.all([i.e(7885),i.e(6933)]).then(i.bind(i,4173)).then((e=>e.default)))),m(50001,(()=>i.e(1588).then(i.bind(i,1588)).then((e=>e.default))));const S="undefined"!=typeof navigator&&navigator.hardwareConcurrency||2,A=class{constructor(e=S,t){this.workers=null,this._awaitingDecoder=null,this.size=e,this.messageId=0,e&&(this._awaitingDecoder=t?Promise.resolve(t):new Promise((e=>{i.e(8831).then(i.bind(i,8831)).then((t=>{e(t.create)}))})),this._awaitingDecoder.then((t=>{this._awaitingDecoder=null,this.workers=[];for(let i=0;i<e;i++)this.workers.push({worker:t(),idle:!0})})))}async decode(e,t){return this._awaitingDecoder&&await this._awaitingDecoder,0===this.size?b(e).then((i=>i.decode(e,t))):new Promise((i=>{const r=this.workers.find((e=>e.idle))||this.workers[Math.floor(Math.random()*this.size)];r.idle=!1;const s=this.messageId++,n=e=>{e.data.id===s&&(r.idle=!0,i(e.data.decoded),r.worker.removeEventListener("message",n))};r.worker.addEventListener("message",n),r.worker.postMessage({fileDirectory:e,buffer:t,id:s},[t])}))}destroy(){this.workers&&(this.workers.forEach((e=>{e.worker.terminate()})),this.workers=null)}};function I(e){return(t,...i)=>T(e,t,i)}function v(e,t){return I(_(e,t).get)}const{apply:T,construct:x,defineProperty:D,get:E,getOwnPropertyDescriptor:_,getPrototypeOf:P,has:C,ownKeys:M,set:k,setPrototypeOf:F}=Reflect,{MAX_SAFE_INTEGER:G,isFinite:R,isNaN:O}=(Proxy,Number),{iterator:U,species:L,toStringTag:N,for:B}=Symbol,K=Object,{create:z,defineProperty:V,freeze:j,is:q}=K,H=K.prototype,W=(H.__lookupGetter__&&I(H.__lookupGetter__),K.hasOwn||I(H.hasOwnProperty),Array),$=(W.isArray,W.prototype),Z=(I($.join),I($.push),I($.toLocaleString),$[U]),Y=I(Z),X=(Math.trunc,ArrayBuffer),J=(X.isView,X.prototype),Q=(I(J.slice),v(J,"byteLength"),"undefined"!=typeof SharedArrayBuffer?SharedArrayBuffer:null),ee=(Q&&v(Q.prototype,"byteLength"),P(Uint8Array)),te=(ee.from,ee.prototype),ie=(te[U],I(te.keys),I(te.values),I(te.entries),I(te.set),I(te.reverse),I(te.fill),I(te.copyWithin),I(te.sort),I(te.slice),I(te.subarray),v(te,"buffer"),v(te,"byteOffset"),v(te,"length"),v(te,N),Uint16Array,Uint32Array),re=Float32Array,se=P([][U]()),ne=I(se.next),oe=I(function*(){}().next),ae=P(se),le=DataView.prototype,he=I(le.getUint16),ce=(I(le.setUint16),TypeError,RangeError,WeakSet.prototype),ue=(I(ce.add),I(ce.has),WeakMap),fe=ue.prototype,ge=I(fe.get),de=(I(fe.has),I(fe.set)),pe=new ue,ye=z(null,{next:{value:function(){const e=ge(pe,this);return ne(e)}},[U]:{value:function(){return this}}}),we=new ue,me=z(ae,{next:{value:function(){const e=ge(we,this);return oe(e)},writable:!0,configurable:!0}});for(const e of M(se))"next"!==e&&V(me,e,_(se,e));const be=new X(4),Se=new re(be),Ae=new ie(be),Ie=new ie(512),ve=new ie(512);for(let e=0;e<256;++e){const t=e-127;t<-27?(Ie[e]=0,Ie[256|e]=32768,ve[e]=24,ve[256|e]=24):t<-14?(Ie[e]=1024>>-t-14,Ie[256|e]=1024>>-t-14|32768,ve[e]=-t-1,ve[256|e]=-t-1):t<=15?(Ie[e]=t+15<<10,Ie[256|e]=t+15<<10|32768,ve[e]=13,ve[256|e]=13):t<128?(Ie[e]=31744,Ie[256|e]=64512,ve[e]=24,ve[256|e]=24):(Ie[e]=31744,Ie[256|e]=64512,ve[e]=13,ve[256|e]=13)}const Te=new ie(2048),xe=new ie(64),De=new ie(64);for(let e=1;e<1024;++e){let t=e<<13,i=0;for(;0==(8388608&t);)t<<=1,i-=8388608;t&=-8388609,i+=947912704,Te[e]=t|i}for(let e=1024;e<2048;++e)Te[e]=939524096+(e-1024<<13);for(let e=1;e<31;++e)xe[e]=e<<23;xe[31]=1199570944,xe[32]=2147483648;for(let e=33;e<63;++e)xe[e]=2147483648+(e-32<<23);xe[63]=3347054592;for(let e=1;e<64;++e)32!==e&&(De[e]=1024);function Ee(e,t,...i){return function(e){const t=e>>10;return Ae[0]=Te[De[t]+(1023&e)]+xe[t],Se[0]}(he(e,t,...function(e){if(e[U]===Z&&se.next===ne)return e;const t=z(ye);return de(pe,t,Y(e)),t}(i)))}var _e=i(8330),Pe=i(8602);function Ce(e,t,i,r=1){return new(Object.getPrototypeOf(e).constructor)(t*i*r)}function Me(e,t,i){return(1-i)*e+i*t}function ke(e,t,i){let r=0;for(let s=t;s<i;++s)r+=e[s];return r}function Fe(e,t,i){switch(e){case 1:if(t<=8)return new Uint8Array(i);if(t<=16)return new Uint16Array(i);if(t<=32)return new Uint32Array(i);break;case 2:if(8===t)return new Int8Array(i);if(16===t)return new Int16Array(i);if(32===t)return new Int32Array(i);break;case 3:switch(t){case 16:case 32:return new Float32Array(i);case 64:return new Float64Array(i)}}throw Error("Unsupported data format/bitsPerSample")}const Ge=class{constructor(e,t,i,r,s,n){this.fileDirectory=e,this.geoKeys=t,this.dataView=i,this.littleEndian=r,this.tiles=s?{}:null,this.isTiled=!e.StripOffsets;const o=e.PlanarConfiguration;if(this.planarConfiguration=void 0===o?1:o,1!==this.planarConfiguration&&2!==this.planarConfiguration)throw new Error("Invalid planar configuration.");this.source=n}getFileDirectory(){return this.fileDirectory}getGeoKeys(){return this.geoKeys}getWidth(){return this.fileDirectory.ImageWidth}getHeight(){return this.fileDirectory.ImageLength}getSamplesPerPixel(){return void 0!==this.fileDirectory.SamplesPerPixel?this.fileDirectory.SamplesPerPixel:1}getTileWidth(){return this.isTiled?this.fileDirectory.TileWidth:this.getWidth()}getTileHeight(){return this.isTiled?this.fileDirectory.TileLength:void 0!==this.fileDirectory.RowsPerStrip?Math.min(this.fileDirectory.RowsPerStrip,this.getHeight()):this.getHeight()}getBlockWidth(){return this.getTileWidth()}getBlockHeight(e){return this.isTiled||(e+1)*this.getTileHeight()<=this.getHeight()?this.getTileHeight():this.getHeight()-e*this.getTileHeight()}getBytesPerPixel(){let e=0;for(let t=0;t<this.fileDirectory.BitsPerSample.length;++t)e+=this.getSampleByteSize(t);return e}getSampleByteSize(e){if(e>=this.fileDirectory.BitsPerSample.length)throw new RangeError(`Sample index ${e} is out of range.`);return Math.ceil(this.fileDirectory.BitsPerSample[e]/8)}getReaderForSample(e){const t=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1,i=this.fileDirectory.BitsPerSample[e];switch(t){case 1:if(i<=8)return DataView.prototype.getUint8;if(i<=16)return DataView.prototype.getUint16;if(i<=32)return DataView.prototype.getUint32;break;case 2:if(i<=8)return DataView.prototype.getInt8;if(i<=16)return DataView.prototype.getInt16;if(i<=32)return DataView.prototype.getInt32;break;case 3:switch(i){case 16:return function(e,t){return Ee(this,e,t)};case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64}}throw Error("Unsupported data format/bitsPerSample")}getSampleFormat(e=0){return this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1}getBitsPerSample(e=0){return this.fileDirectory.BitsPerSample[e]}getArrayForSample(e,t){return Fe(this.getSampleFormat(e),this.getBitsPerSample(e),t)}async getTileOrStrip(e,t,i,r,s){const n=Math.ceil(this.getWidth()/this.getTileWidth()),o=Math.ceil(this.getHeight()/this.getTileHeight());let a;const{tiles:l}=this;let h,c;1===this.planarConfiguration?a=t*n+e:2===this.planarConfiguration&&(a=i*n*o+t*n+e),this.isTiled?(h=this.fileDirectory.TileOffsets[a],c=this.fileDirectory.TileByteCounts[a]):(h=this.fileDirectory.StripOffsets[a],c=this.fileDirectory.StripByteCounts[a]);const u=(await this.source.fetch([{offset:h,length:c}],s))[0];let f;return null!==l&&l[a]?f=l[a]:(f=(async()=>{let e=await r.decode(this.fileDirectory,u);const i=this.getSampleFormat(),s=this.getBitsPerSample();return function(e,t){return(1!==e&&2!==e||!(t<=32)||t%8!=0)&&(3!==e||16!==t&&32!==t&&64!==t)}(i,s)&&(e=function(e,t,i,r,s,n,o){const a=new DataView(e),l=2===i?1:r,h=Fe(t,s,2===i?o*n:o*n*r),c=parseInt("1".repeat(s),2);if(1===t){let e;e=1===i?r*s:s;let t=n*e;0!=(7&t)&&(t=t+7&-8);for(let e=0;e<o;++e){const i=e*t;for(let t=0;t<n;++t){const r=i+t*l*s;for(let i=0;i<l;++i){const o=r+i*s,u=(e*n+t)*l+i,f=Math.floor(o/8),g=o%8;if(g+s<=8)h[u]=a.getUint8(f)>>8-s-g&c;else if(g+s<=16)h[u]=a.getUint16(f)>>16-s-g&c;else if(g+s<=24){const e=a.getUint16(f)<<8|a.getUint8(f+2);h[u]=e>>24-s-g&c}else h[u]=a.getUint32(f)>>32-s-g&c}}}}return h.buffer}(e,i,this.planarConfiguration,this.getSamplesPerPixel(),s,this.getTileWidth(),this.getBlockHeight(t))),e})(),null!==l&&(l[a]=f)),{x:e,y:t,sample:i,data:await f}}async _readRaster(e,t,i,r,s,n,o,a,l){const h=this.getTileWidth(),c=this.getTileHeight(),u=this.getWidth(),f=this.getHeight(),g=Math.max(Math.floor(e[0]/h),0),d=Math.min(Math.ceil(e[2]/h),Math.ceil(u/h)),p=Math.max(Math.floor(e[1]/c),0),y=Math.min(Math.ceil(e[3]/c),Math.ceil(f/c)),w=e[2]-e[0];let m=this.getBytesPerPixel();const b=[],S=[];for(let e=0;e<t.length;++e)1===this.planarConfiguration?b.push(ke(this.fileDirectory.BitsPerSample,0,t[e])/8):b.push(0),S.push(this.getReaderForSample(t[e]));const A=[],{littleEndian:I}=this;for(let n=p;n<y;++n)for(let o=g;o<d;++o)for(let a=0;a<t.length;++a){const g=a,d=t[a];2===this.planarConfiguration&&(m=this.getSampleByteSize(a));const p=this.getTileOrStrip(o,n,d,s,l);A.push(p),p.then((s=>{const n=s.data,o=new DataView(n),a=this.getBlockHeight(s.y),l=s.y*c,d=s.x*h,p=l+a,y=(s.x+1)*h,A=S[g],v=Math.min(a,a-(p-e[3]),f-l),T=Math.min(h,h-(y-e[2]),u-d);for(let s=Math.max(0,e[1]-l);s<v;++s)for(let n=Math.max(0,e[0]-d);n<T;++n){const a=(s*h+n)*m,c=A.call(o,a+b[g],I);let u;r?(u=(s+l-e[1])*w*t.length+(n+d-e[0])*t.length+g,i[u]=c):(u=(s+l-e[1])*w+n+d-e[0],i[g][u]=c)}}))}if(await Promise.all(A),n&&e[2]-e[0]!==n||o&&e[3]-e[1]!==o){let s;return s=r?function(e,t,i,r,s,n,o="nearest"){switch(o.toLowerCase()){case"nearest":return function(e,t,i,r,s,n){const o=t/r,a=i/s,l=Ce(e,r,s,n);for(let h=0;h<s;++h){const s=Math.min(Math.round(a*h),i-1);for(let i=0;i<r;++i){const a=Math.min(Math.round(o*i),t-1);for(let o=0;o<n;++o){const c=e[s*t*n+a*n+o];l[h*r*n+i*n+o]=c}}}return l}(e,t,i,r,s,n);case"bilinear":case"linear":return function(e,t,i,r,s,n){const o=t/r,a=i/s,l=Ce(e,r,s,n);for(let h=0;h<s;++h){const s=a*h,c=Math.floor(s),u=Math.min(Math.ceil(s),i-1);for(let i=0;i<r;++i){const a=o*i,f=a%1,g=Math.floor(a),d=Math.min(Math.ceil(a),t-1);for(let o=0;o<n;++o){const a=e[c*t*n+g*n+o],p=e[c*t*n+d*n+o],y=e[u*t*n+g*n+o],w=e[u*t*n+d*n+o],m=Me(Me(a,p,f),Me(y,w,f),s%1);l[h*r*n+i*n+o]=m}}}return l}(e,t,i,r,s,n);default:throw new Error(`Unsupported resampling method: '${o}'`)}}(i,e[2]-e[0],e[3]-e[1],n,o,t.length,a):function(e,t,i,r,s,n="nearest"){switch(n.toLowerCase()){case"nearest":return function(e,t,i,r,s){const n=t/r,o=i/s;return e.map((e=>{const a=Ce(e,r,s);for(let l=0;l<s;++l){const s=Math.min(Math.round(o*l),i-1);for(let i=0;i<r;++i){const o=Math.min(Math.round(n*i),t-1),h=e[s*t+o];a[l*r+i]=h}}return a}))}(e,t,i,r,s);case"bilinear":case"linear":return function(e,t,i,r,s){const n=t/r,o=i/s;return e.map((e=>{const a=Ce(e,r,s);for(let l=0;l<s;++l){const s=o*l,h=Math.floor(s),c=Math.min(Math.ceil(s),i-1);for(let i=0;i<r;++i){const o=n*i,u=o%1,f=Math.floor(o),g=Math.min(Math.ceil(o),t-1),d=e[h*t+f],p=e[h*t+g],y=e[c*t+f],w=e[c*t+g],m=Me(Me(d,p,u),Me(y,w,u),s%1);a[l*r+i]=m}}return a}))}(e,t,i,r,s);default:throw new Error(`Unsupported resampling method: '${n}'`)}}(i,e[2]-e[0],e[3]-e[1],n,o,a),s.width=n,s.height=o,s}return i.width=n||e[2]-e[0],i.height=o||e[3]-e[1],i}async readRasters({window:e,samples:t=[],interleave:i,pool:r=null,width:s,height:n,resampleMethod:o,fillValue:a,signal:l}={}){const h=e||[0,0,this.getWidth(),this.getHeight()];if(h[0]>h[2]||h[1]>h[3])throw new Error("Invalid subsets");const c=(h[2]-h[0])*(h[3]-h[1]),u=this.getSamplesPerPixel();if(t&&t.length){for(let e=0;e<t.length;++e)if(t[e]>=u)return Promise.reject(new RangeError(`Invalid sample index '${t[e]}'.`))}else for(let e=0;e<u;++e)t.push(e);let f;if(i)f=Fe(this.fileDirectory.SampleFormat?Math.max.apply(null,this.fileDirectory.SampleFormat):1,Math.max.apply(null,this.fileDirectory.BitsPerSample),c*t.length),a&&f.fill(a);else{f=[];for(let e=0;e<t.length;++e){const i=this.getArrayForSample(t[e],c);Array.isArray(a)&&e<a.length?i.fill(a[e]):a&&!Array.isArray(a)&&i.fill(a),f.push(i)}}const g=r||await b(this.fileDirectory);return await this._readRaster(h,t,f,i,g,s,n,o,l)}async readRGB({window:e,interleave:t=!0,pool:i=null,width:r,height:s,resampleMethod:n,enableAlpha:o=!1,signal:a}={}){const l=e||[0,0,this.getWidth(),this.getHeight()];if(l[0]>l[2]||l[1]>l[3])throw new Error("Invalid subsets");const h=this.fileDirectory.PhotometricInterpretation;if(h===y.Ie.RGB){let l=[0,1,2];if(this.fileDirectory.ExtraSamples!==y.pd.Unspecified&&o){l=[];for(let e=0;e<this.fileDirectory.BitsPerSample.length;e+=1)l.push(e)}return this.readRasters({window:e,interleave:t,samples:l,pool:i,width:r,height:s,resampleMethod:n,signal:a})}let c;switch(h){case y.Ie.WhiteIsZero:case y.Ie.BlackIsZero:case y.Ie.Palette:c=[0];break;case y.Ie.CMYK:c=[0,1,2,3];break;case y.Ie.YCbCr:case y.Ie.CIELab:c=[0,1,2];break;default:throw new Error("Invalid or unsupported photometric interpretation.")}const u={window:l,interleave:!0,samples:c,pool:i,width:r,height:s,resampleMethod:n,signal:a},{fileDirectory:f}=this,g=await this.readRasters(u),d=2**this.fileDirectory.BitsPerSample[0];let p;switch(h){case y.Ie.WhiteIsZero:p=function(e,t){const{width:i,height:r}=e,s=new Uint8Array(i*r*3);let n;for(let i=0,r=0;i<e.length;++i,r+=3)n=256-e[i]/t*256,s[r]=n,s[r+1]=n,s[r+2]=n;return s}(g,d);break;case y.Ie.BlackIsZero:p=function(e,t){const{width:i,height:r}=e,s=new Uint8Array(i*r*3);let n;for(let i=0,r=0;i<e.length;++i,r+=3)n=e[i]/t*256,s[r]=n,s[r+1]=n,s[r+2]=n;return s}(g,d);break;case y.Ie.Palette:p=function(e,t){const{width:i,height:r}=e,s=new Uint8Array(i*r*3),n=t.length/3,o=t.length/3*2;for(let i=0,r=0;i<e.length;++i,r+=3){const a=e[i];s[r]=t[a]/65536*256,s[r+1]=t[a+n]/65536*256,s[r+2]=t[a+o]/65536*256}return s}(g,f.ColorMap);break;case y.Ie.CMYK:p=function(e){const{width:t,height:i}=e,r=new Uint8Array(t*i*3);for(let t=0,i=0;t<e.length;t+=4,i+=3){const s=e[t],n=e[t+1],o=e[t+2],a=e[t+3];r[i]=(255-s)/256*255*((255-a)/256),r[i+1]=(255-n)/256*255*((255-a)/256),r[i+2]=(255-o)/256*255*((255-a)/256)}return r}(g);break;case y.Ie.YCbCr:p=function(e){const{width:t,height:i}=e,r=new Uint8ClampedArray(t*i*3);for(let t=0,i=0;t<e.length;t+=3,i+=3){const s=e[t],n=e[t+1],o=e[t+2];r[i]=s+1.402*(o-128),r[i+1]=s-.34414*(n-128)-.71414*(o-128),r[i+2]=s+1.772*(n-128)}return r}(g);break;case y.Ie.CIELab:p=function(e){const{width:t,height:i}=e,r=new Uint8Array(t*i*3);for(let t=0,i=0;t<e.length;t+=3,i+=3){let s,n,o,a=(e[t+0]+16)/116,l=(e[t+1]<<24>>24)/500+a,h=a-(e[t+2]<<24>>24)/200;l=.95047*(l*l*l>.008856?l*l*l:(l-16/116)/7.787),a=1*(a*a*a>.008856?a*a*a:(a-16/116)/7.787),h=1.08883*(h*h*h>.008856?h*h*h:(h-16/116)/7.787),s=3.2406*l+-1.5372*a+-.4986*h,n=-.9689*l+1.8758*a+.0415*h,o=.0557*l+-.204*a+1.057*h,s=s>.0031308?1.055*s**(1/2.4)-.055:12.92*s,n=n>.0031308?1.055*n**(1/2.4)-.055:12.92*n,o=o>.0031308?1.055*o**(1/2.4)-.055:12.92*o,r[i]=255*Math.max(0,Math.min(1,s)),r[i+1]=255*Math.max(0,Math.min(1,n)),r[i+2]=255*Math.max(0,Math.min(1,o))}return r}(g);break;default:throw new Error("Unsupported photometric interpretation.")}if(!t){const e=new Uint8Array(p.length/3),t=new Uint8Array(p.length/3),i=new Uint8Array(p.length/3);for(let r=0,s=0;r<p.length;r+=3,++s)e[s]=p[r],t[s]=p[r+1],i[s]=p[r+2];p=[e,t,i]}return p.width=g.width,p.height=g.height,p}getTiePoints(){if(!this.fileDirectory.ModelTiepoint)return[];const e=[];for(let t=0;t<this.fileDirectory.ModelTiepoint.length;t+=6)e.push({i:this.fileDirectory.ModelTiepoint[t],j:this.fileDirectory.ModelTiepoint[t+1],k:this.fileDirectory.ModelTiepoint[t+2],x:this.fileDirectory.ModelTiepoint[t+3],y:this.fileDirectory.ModelTiepoint[t+4],z:this.fileDirectory.ModelTiepoint[t+5]});return e}getGDALMetadata(e=null){const t={};if(!this.fileDirectory.GDAL_METADATA)return null;const i=this.fileDirectory.GDAL_METADATA;let r=Pe(i,"Item");r=null===e?r.filter((e=>void 0===_e(e,"sample"))):r.filter((t=>Number(_e(t,"sample"))===e));for(let e=0;e<r.length;++e){const i=r[e];t[_e(i,"name")]=i.inner}return t}getGDALNoData(){if(!this.fileDirectory.GDAL_NODATA)return null;const e=this.fileDirectory.GDAL_NODATA;return Number(e.substring(0,e.length-1))}getOrigin(){const e=this.fileDirectory.ModelTiepoint,t=this.fileDirectory.ModelTransformation;if(e&&6===e.length)return[e[3],e[4],e[5]];if(t)return[t[3],t[7],t[11]];throw new Error("The image does not have an affine transformation.")}getResolution(e=null){const t=this.fileDirectory.ModelPixelScale,i=this.fileDirectory.ModelTransformation;if(t)return[t[0],-t[1],t[2]];if(i)return[i[0],i[5],i[10]];if(e){const[t,i,r]=e.getResolution();return[t*e.getWidth()/this.getWidth(),i*e.getHeight()/this.getHeight(),r*e.getWidth()/this.getWidth()]}throw new Error("The image does not have an affine transformation.")}pixelIsArea(){return 1===this.geoKeys.GTRasterTypeGeoKey}getBoundingBox(){const e=this.getOrigin(),t=this.getResolution(),i=e[0],r=e[1],s=i+t[0]*this.getWidth(),n=r+t[1]*this.getHeight();return[Math.min(i,s),Math.min(r,n),Math.max(i,s),Math.max(r,n)]}};class Re{constructor(e){this._dataView=new DataView(e)}get buffer(){return this._dataView.buffer}getUint64(e,t){const i=this.getUint32(e,t),r=this.getUint32(e+4,t);let s;if(t){if(s=i+2**32*r,!Number.isSafeInteger(s))throw new Error(`${s} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return s}if(s=2**32*i+r,!Number.isSafeInteger(s))throw new Error(`${s} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return s}getInt64(e,t){let i=0;const r=(128&this._dataView.getUint8(e+(t?7:0)))>0;let s=!0;for(let n=0;n<8;n++){let o=this._dataView.getUint8(e+(t?n:7-n));r&&(s?0!==o&&(o=255&~(o-1),s=!1):o=255&~o),i+=o*256**n}return r&&(i=-i),i}getUint8(e,t){return this._dataView.getUint8(e,t)}getInt8(e,t){return this._dataView.getInt8(e,t)}getUint16(e,t){return this._dataView.getUint16(e,t)}getInt16(e,t){return this._dataView.getInt16(e,t)}getUint32(e,t){return this._dataView.getUint32(e,t)}getInt32(e,t){return this._dataView.getInt32(e,t)}getFloat16(e,t){return Ee(this._dataView,e,t)}getFloat32(e,t){return this._dataView.getFloat32(e,t)}getFloat64(e,t){return this._dataView.getFloat64(e,t)}}class Oe{constructor(e,t,i,r){this._dataView=new DataView(e),this._sliceOffset=t,this._littleEndian=i,this._bigTiff=r}get sliceOffset(){return this._sliceOffset}get sliceTop(){return this._sliceOffset+this.buffer.byteLength}get littleEndian(){return this._littleEndian}get bigTiff(){return this._bigTiff}get buffer(){return this._dataView.buffer}covers(e,t){return this.sliceOffset<=e&&this.sliceTop>=e+t}readUint8(e){return this._dataView.getUint8(e-this._sliceOffset,this._littleEndian)}readInt8(e){return this._dataView.getInt8(e-this._sliceOffset,this._littleEndian)}readUint16(e){return this._dataView.getUint16(e-this._sliceOffset,this._littleEndian)}readInt16(e){return this._dataView.getInt16(e-this._sliceOffset,this._littleEndian)}readUint32(e){return this._dataView.getUint32(e-this._sliceOffset,this._littleEndian)}readInt32(e){return this._dataView.getInt32(e-this._sliceOffset,this._littleEndian)}readFloat32(e){return this._dataView.getFloat32(e-this._sliceOffset,this._littleEndian)}readFloat64(e){return this._dataView.getFloat64(e-this._sliceOffset,this._littleEndian)}readUint64(e){const t=this.readUint32(e),i=this.readUint32(e+4);let r;if(this._littleEndian){if(r=t+2**32*i,!Number.isSafeInteger(r))throw new Error(`${r} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return r}if(r=2**32*t+i,!Number.isSafeInteger(r))throw new Error(`${r} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return r}readInt64(e){let t=0;const i=(128&this._dataView.getUint8(e+(this._littleEndian?7:0)))>0;let r=!0;for(let s=0;s<8;s++){let n=this._dataView.getUint8(e+(this._littleEndian?s:7-s));i&&(r?0!==n&&(n=255&~(n-1),r=!1):n=255&~n),t+=n*256**s}return i&&(t=-t),t}readOffset(e){return this._bigTiff?this.readUint64(e):this.readUint32(e)}}const Ue="\r\n\r\n";function Le(e){if(void 0!==Object.fromEntries)return Object.fromEntries(e);const t={};for(const[i,r]of e)t[i.toLowerCase()]=r;return t}function Ne(e){return Le(e.split("\r\n").map((e=>{const t=e.split(":").map((e=>e.trim()));return t[0]=t[0].toLowerCase(),t})))}function Be(e){let t,i,r;return e&&([,t,i,r]=e.match(/bytes (\d+)-(\d+)\/(\d+)/),t=parseInt(t,10),i=parseInt(i,10),r=parseInt(r,10)),{start:t,end:i,total:r}}class Ke{async fetch(e,t=undefined){return Promise.all(e.map((e=>this.fetchSlice(e,t))))}async fetchSlice(e){throw new Error(`fetching of slice ${e} not possible, not implemented`)}get fileSize(){return null}async close(){}}var ze=i(6368);function Ve(e,t){const i=Array.isArray(e)?e:Array.from(e),r=Array.isArray(t)?t:Array.from(t);return i.map(((e,t)=>[e,r[t]]))}class je extends Error{constructor(e){super(e),Error.captureStackTrace&&Error.captureStackTrace(this,je),this.name="AbortError"}}class qe extends Error{constructor(e,t){super(t),this.errors=e,this.message=t,this.name="AggregateError"}}const He=qe;class We{constructor(e,t,i=null){this.offset=e,this.length=t,this.data=i}get top(){return this.offset+this.length}}class $e{constructor(e,t,i){this.offset=e,this.length=t,this.blockIds=i}}class Ze extends Ke{constructor(e,{blockSize:t=65536,cacheSize:i=100}={}){super(),this.source=e,this.blockSize=t,this.blockCache=new ze({max:i}),this.blockRequests=new Map,this.blockIdsToFetch=new Set}get fileSize(){return this.source.fileSize}async fetch(e,t){const i=new Map,r=new Map,s=new Set;for(const{offset:t,length:n}of e){let e=t+n;const{fileSize:o}=this;null!==o&&(e=Math.min(e,o));for(let n=Math.floor(t/this.blockSize)*this.blockSize;n<e;n+=this.blockSize){const e=Math.floor(n/this.blockSize);this.blockCache.has(e)?i.set(e,this.blockCache.get(e)):this.blockRequests.has(e)?r.set(e,this.blockRequests.get(e)):(this.blockIdsToFetch.has(e)||this.blockIdsToFetch.add(e),s.add(e))}}await async function(e){return new Promise((e=>setTimeout(e,undefined)))}(),this.fetchBlocks(t);for(const e of s){const t=this.blockRequests.get(e),s=this.blockCache.get(e);if(t)r.set(e,t);else{if(!s)throw new Error(`Block ${e} is not in the block requests`);i.set(e,s)}}let n=await Promise.allSettled(Array.from(r.values()));if(n.some((e=>"rejected"===e.status))){const e=new Set;for(const[i,s]of Ve(r.keys(),n)){const{rejected:r,reason:n}=s;r&&"AbortError"===n.name&&n.signal!==t&&(this.blockIdsToFetch.add(i),e.add(i))}if(this.blockIdsToFetch.length>0){this.fetchBlocks(t);for(const t of e){const e=this.blockRequests.get(t);if(!e)throw new Error(`Block ${t} is not in the block requests`);r.set(t,e)}n=await Promise.allSettled(Array.from(r.values()))}}if(n.some((e=>"rejected"===e.status))){if(t&&t.aborted)throw new je("Request was aborted");throw new He(n.filter((e=>"rejected"===e.status)).map((e=>e.reason)),"Request failed")}const o=n.map((e=>e.value)),a=new Map(Ve(Array.from(r.keys()),o));for(const[e,t]of i)a.set(e,t);return this.readSliceData(e,a)}fetchBlocks(e){if(this.blockIdsToFetch.size>0){const t=this.groupBlocks(this.blockIdsToFetch),i=this.source.fetch(t,e);for(let r=0;r<t.length;++r){const s=t[r];for(const t of s.blockIds){const s=(async()=>{try{const e=(await i)[r],s=t*this.blockSize,n=s-e.offset,o=Math.min(n+this.blockSize,e.data.byteLength),a=e.data.slice(n,o),l=new We(s,a.byteLength,a);return this.blockCache.set(t,l),l}catch(t){throw"AbortError"===t.name&&(t.signal=e),t}finally{this.blockRequests.delete(t)}})();this.blockRequests.set(t,s)}}this.blockIdsToFetch.clear()}}groupBlocks(e){const t=Array.from(e).sort(((e,t)=>e-t));if(0===t.length)return[];let i=[],r=null;const s=[];for(const e of t)null===r||r+1===e?(i.push(e),r=e):(s.push(new $e(i[0]*this.blockSize,i.length*this.blockSize,i)),i=[e],r=e);return s.push(new $e(i[0]*this.blockSize,i.length*this.blockSize,i)),s}readSliceData(e,t){return e.map((e=>{const i=e.offset+e.length,r=Math.floor(e.offset/this.blockSize),s=Math.floor((e.offset+e.length)/this.blockSize),n=new ArrayBuffer(e.length),o=new Uint8Array(n);for(let n=r;n<=s;++n){const r=t.get(n),s=r.offset-e.offset;let a,l=0,h=0;s<0?l=-s:s>0&&(h=s),a=r.top-i<0?r.length-l:i-r.offset-l;const c=new Uint8Array(r.data,l,a);o.set(c,h)}return n}))}}class Ye{get ok(){return this.status>=200&&this.status<=299}get status(){throw new Error("not implemented")}getHeader(e){throw new Error("not implemented")}async getData(){throw new Error("not implemented")}}class Xe{constructor(e){this.url=e}async request({headers:e,credentials:t,signal:i}={}){throw new Error("request is not implemented")}}class Je extends Ye{constructor(e){super(),this.response=e}get status(){return this.response.status}getHeader(e){return this.response.headers.get(e)}async getData(){return this.response.arrayBuffer?await this.response.arrayBuffer():(await this.response.buffer()).buffer}}class Qe extends Xe{constructor(e,t){super(e),this.credentials=t}async request({headers:e,credentials:t,signal:i}={}){const r=await fetch(this.url,{headers:e,credentials:t,signal:i});return new Je(r)}}class et extends Ye{constructor(e,t){super(),this.xhr=e,this.data=t}get status(){return this.xhr.status}getHeader(e){return this.xhr.getResponseHeader(e)}async getData(){return this.data}}class tt extends Xe{constructRequest(e,t){return new Promise(((i,r)=>{const s=new XMLHttpRequest;s.open("GET",this.url),s.responseType="arraybuffer";for(const[t,i]of Object.entries(e))s.setRequestHeader(t,i);s.onload=()=>{const e=s.response;i(new et(s,e))},s.onerror=r,s.onabort=()=>r(new je("Request aborted")),s.send(),t&&(t.aborted&&s.abort(),t.addEventListener("abort",(()=>s.abort())))}))}async request({headers:e,signal:t}={}){return await this.constructRequest(e,t)}}var it=i(3752),rt=i(3640),st=i(2630);class nt extends Ye{constructor(e,t){super(),this.response=e,this.dataPromise=t}get status(){return this.response.statusCode}getHeader(e){return this.response.headers[e]}async getData(){return await this.dataPromise}}class ot extends Xe{constructor(e){super(e),this.parsedUrl=st.parse(this.url),this.httpApi="http:"===this.parsedUrl.protocol?it:rt}constructRequest(e,t){return new Promise(((i,r)=>{const s=this.httpApi.get({...this.parsedUrl,headers:e},(e=>{const t=new Promise((t=>{const i=[];e.on("data",(e=>{i.push(e)})),e.on("end",(()=>{const e=Buffer.concat(i).buffer;t(e)})),e.on("error",r)}));i(new nt(e,t))}));s.on("error",r),t&&(t.aborted&&s.destroy(new je("Request aborted")),t.addEventListener("abort",(()=>s.destroy(new je("Request aborted")))))}))}async request({headers:e,signal:t}={}){return await this.constructRequest(e,t)}}class at extends Ke{constructor(e,t,i,r){super(),this.client=e,this.headers=t,this.maxRanges=i,this.allowFullFile=r,this._fileSize=null}async fetch(e,t){return this.maxRanges>=e.length?this.fetchSlices(e,t):(this.maxRanges>0&&e.length,Promise.all(e.map((e=>this.fetchSlice(e,t)))))}async fetchSlices(e,t){const i=await this.client.request({headers:{...this.headers,Range:`bytes=${e.map((({offset:e,length:t})=>`${e}-${e+t}`)).join(",")}`},signal:t});if(i.ok){if(206===i.status){const{type:r,params:s}=function(e){const[t,...i]=e.split(";").map((e=>e.trim()));return{type:t,params:Le(i.map((e=>e.split("="))))}}(i.getHeader("content-type"));if("multipart/byteranges"===r){const e=function(e,t){let i=null;const r=new TextDecoder("ascii"),s=[],n=`--${t}`,o=`${n}--`;for(let t=0;t<10;++t)r.decode(new Uint8Array(e,t,n.length))===n&&(i=t);if(null===i)throw new Error("Could not find initial boundary");for(;i<e.byteLength;){const t=r.decode(new Uint8Array(e,i,Math.min(n.length+1024,e.byteLength-i)));if(0===t.length||t.startsWith(o))break;if(!t.startsWith(n))throw new Error("Part does not start with boundary");const a=t.substr(n.length+2);if(0===a.length)break;const l=a.indexOf(Ue),h=Ne(a.substr(0,l)),{start:c,end:u,total:f}=Be(h["content-range"]),g=i+n.length+l+Ue.length,d=parseInt(u,10)+1-parseInt(c,10);s.push({headers:h,data:e.slice(g,g+d),offset:c,length:d,fileSize:f}),i=g+d+4}return s}(await i.getData(),s.boundary);return this._fileSize=e[0].fileSize||null,e}const n=await i.getData(),{start:o,end:a,total:l}=Be(i.getHeader("content-range"));this._fileSize=l||null;const h=[{data:n,offset:o,length:a-o}];if(e.length>1){const i=await Promise.all(e.slice(1).map((e=>this.fetchSlice(e,t))));return h.concat(i)}return h}{if(!this.allowFullFile)throw new Error("Server responded with full file");const e=await i.getData();return this._fileSize=e.byteLength,[{data:e,offset:0,length:e.byteLength}]}}throw new Error("Error fetching data.")}async fetchSlice(e,t){const{offset:i,length:r}=e,s=await this.client.request({headers:{...this.headers,Range:`bytes=${i}-${i+r}`},signal:t});if(s.ok){if(206===s.status){const e=await s.getData(),{total:t}=Be(s.getHeader("content-range"));return this._fileSize=t||null,{data:e,offset:i,length:r}}{if(!this.allowFullFile)throw new Error("Server responded with full file");const e=await s.getData();return this._fileSize=e.byteLength,{data:e,offset:0,length:e.byteLength}}}throw new Error("Error fetching data.")}get fileSize(){return this._fileSize}}function lt(e,{blockSize:t,cacheSize:i}){return null===t?e:new Ze(e,t,i)}function ht(e,{forceXHR:t=!1,...i}={}){return"function"!=typeof fetch||t?"undefined"!=typeof XMLHttpRequest?function(e,{headers:t={},maxRanges:i=0,allowFullFile:r=!1,...s}={}){const n=new tt(e);return lt(new at(n,t,i,r),s)}(e,i):function(e,{headers:t={},maxRanges:i=0,allowFullFile:r=!1,...s}={}){const n=new ot(e);return lt(new at(n,t,i,r),s)}(e,i):function(e,{headers:t={},credentials:i,maxRanges:r=0,allowFullFile:s=!1,...n}={}){const o=new Qe(e,i);return lt(new at(o,t,r,s),n)}(e,i)}class ct extends Ke{constructor(e){super(),this.file=e}async fetchSlice(e,t){return new Promise(((i,r)=>{const s=this.file.slice(e.offset,e.offset+e.length),n=new FileReader;n.onload=e=>i(e.target.result),n.onerror=r,n.onabort=r,n.readAsArrayBuffer(s),t&&t.addEventListener("abort",(()=>n.abort()))}))}}function ut(e){switch(e){case y.sf.BYTE:case y.sf.ASCII:case y.sf.SBYTE:case y.sf.UNDEFINED:return 1;case y.sf.SHORT:case y.sf.SSHORT:return 2;case y.sf.LONG:case y.sf.SLONG:case y.sf.FLOAT:case y.sf.IFD:return 4;case y.sf.RATIONAL:case y.sf.SRATIONAL:case y.sf.DOUBLE:case y.sf.LONG8:case y.sf.SLONG8:case y.sf.IFD8:return 8;default:throw new RangeError(`Invalid field type: ${e}`)}}function ft(e,t,i,r){let s=null,n=null;const o=ut(t);switch(t){case y.sf.BYTE:case y.sf.ASCII:case y.sf.UNDEFINED:s=new Uint8Array(i),n=e.readUint8;break;case y.sf.SBYTE:s=new Int8Array(i),n=e.readInt8;break;case y.sf.SHORT:s=new Uint16Array(i),n=e.readUint16;break;case y.sf.SSHORT:s=new Int16Array(i),n=e.readInt16;break;case y.sf.LONG:case y.sf.IFD:s=new Uint32Array(i),n=e.readUint32;break;case y.sf.SLONG:s=new Int32Array(i),n=e.readInt32;break;case y.sf.LONG8:case y.sf.IFD8:s=new Array(i),n=e.readUint64;break;case y.sf.SLONG8:s=new Array(i),n=e.readInt64;break;case y.sf.RATIONAL:s=new Uint32Array(2*i),n=e.readUint32;break;case y.sf.SRATIONAL:s=new Int32Array(2*i),n=e.readInt32;break;case y.sf.FLOAT:s=new Float32Array(i),n=e.readFloat32;break;case y.sf.DOUBLE:s=new Float64Array(i),n=e.readFloat64;break;default:throw new RangeError(`Invalid field type: ${t}`)}if(t!==y.sf.RATIONAL&&t!==y.sf.SRATIONAL)for(let t=0;t<i;++t)s[t]=n.call(e,r+t*o);else for(let t=0;t<i;t+=2)s[t]=n.call(e,r+t*o),s[t+1]=n.call(e,r+(t*o+4));return t===y.sf.ASCII?new TextDecoder("utf-8").decode(s):s}class gt{constructor(e,t,i){this.fileDirectory=e,this.geoKeyDirectory=t,this.nextIFDByteOffset=i}}class dt extends Error{constructor(e){super(`No image at index ${e}`),this.index=e}}class pt{async readRasters(e={}){const{window:t,width:i,height:r}=e;let{resX:s,resY:n,bbox:o}=e;const a=await this.getImage();let l=a;const h=await this.getImageCount(),c=a.getBoundingBox();if(t&&o)throw new Error('Both "bbox" and "window" passed.');if(i||r){if(t){const[e,i]=a.getOrigin(),[r,s]=a.getResolution();o=[e+t[0]*r,i+t[1]*s,e+t[2]*r,i+t[3]*s]}const e=o||c;if(i){if(s)throw new Error("Both width and resX passed");s=(e[2]-e[0])/i}if(r){if(n)throw new Error("Both width and resY passed");n=(e[3]-e[1])/r}}if(s||n){const e=[];for(let t=0;t<h;++t){const i=await this.getImage(t),{SubfileType:r,NewSubfileType:s}=i.fileDirectory;(0===t||2===r||1&s)&&e.push(i)}e.sort(((e,t)=>e.getWidth()-t.getWidth()));for(let t=0;t<e.length;++t){const i=e[t],r=(c[2]-c[0])/i.getWidth(),o=(c[3]-c[1])/i.getHeight();if(l=i,s&&s>r||n&&n>o)break}}let u=t;if(o){const[e,t]=a.getOrigin(),[i,r]=l.getResolution(a);u=[Math.round((o[0]-e)/i),Math.round((o[1]-t)/r),Math.round((o[2]-e)/i),Math.round((o[3]-t)/r)],u=[Math.min(u[0],u[2]),Math.min(u[1],u[3]),Math.max(u[0],u[2]),Math.max(u[1],u[3])]}return l.readRasters({...e,window:u})}}class yt extends pt{constructor(e,t,i,r,s={}){super(),this.source=e,this.littleEndian=t,this.bigTiff=i,this.firstIFDOffset=r,this.cache=s.cache||!1,this.ifdRequests=[],this.ghostValues=null}async getSlice(e,t){const i=this.bigTiff?4048:1024;return new Oe((await this.source.fetch([{offset:e,length:void 0!==t?t:i}]))[0],e,this.littleEndian,this.bigTiff)}async parseFileDirectoryAt(e){const t=this.bigTiff?20:12,i=this.bigTiff?8:2;let r=await this.getSlice(e);const s=this.bigTiff?r.readUint64(e):r.readUint16(e),n=s*t+(this.bigTiff?16:6);r.covers(e,n)||(r=await this.getSlice(e,n));const o={};let a=e+(this.bigTiff?8:2);for(let e=0;e<s;a+=t,++e){const e=r.readUint16(a),t=r.readUint16(a+2),i=this.bigTiff?r.readUint64(a+4):r.readUint32(a+4);let s,n;const l=ut(t),h=a+(this.bigTiff?12:8);if(l*i<=(this.bigTiff?8:4))s=ft(r,t,i,h);else{const e=r.readOffset(h),n=ut(t)*i;s=r.covers(e,n)?ft(r,t,i,e):ft(await this.getSlice(e,n),t,i,e)}n=1===i&&-1===y.It.indexOf(e)&&t!==y.sf.RATIONAL&&t!==y.sf.SRATIONAL?s[0]:s,o[y.L[e]]=n}const l=function(e){const t=e.GeoKeyDirectory;if(!t)return null;const i={};for(let r=4;r<=4*t[3];r+=4){const s=y.P1[t[r]],n=t[r+1]?y.L[t[r+1]]:null,o=t[r+2],a=t[r+3];let l=null;if(n){if(l=e[n],null==l)throw new Error(`Could not get value of geoKey '${s}'.`);"string"==typeof l?l=l.substring(a,a+o-1):l.subarray&&(l=l.subarray(a,a+o),1===o&&(l=l[0]))}else l=a;i[s]=l}return i}(o),h=r.readOffset(e+i+t*s);return new gt(o,l,h)}async requestIFD(e){if(this.ifdRequests[e])return this.ifdRequests[e];if(0===e)return this.ifdRequests[e]=this.parseFileDirectoryAt(this.firstIFDOffset),this.ifdRequests[e];if(!this.ifdRequests[e-1])try{this.ifdRequests[e-1]=this.requestIFD(e-1)}catch(t){if(t instanceof dt)throw new dt(e);throw t}return this.ifdRequests[e]=(async()=>{const t=await this.ifdRequests[e-1];if(0===t.nextIFDByteOffset)throw new dt(e);return this.parseFileDirectoryAt(t.nextIFDByteOffset)})(),this.ifdRequests[e]}async getImage(e=0){const t=await this.requestIFD(e);return new Ge(t.fileDirectory,t.geoKeyDirectory,this.dataView,this.littleEndian,this.cache,this.source)}async getImageCount(){let e=0,t=!0;for(;t;)try{await this.requestIFD(e),++e}catch(e){if(!(e instanceof dt))throw e;t=!1}return e}async getGhostValues(){const e=this.bigTiff?16:8;if(this.ghostValues)return this.ghostValues;const t="GDAL_STRUCTURAL_METADATA_SIZE=",i=t.length+100;let r=await this.getSlice(e,i);if(t===ft(r,y.sf.ASCII,t.length,e)){const t=ft(r,y.sf.ASCII,i,e).split("\n")[0],s=Number(t.split("=")[1].split(" ")[0])+t.length;s>i&&(r=await this.getSlice(e,s));const n=ft(r,y.sf.ASCII,s,e);this.ghostValues={},n.split("\n").filter((e=>e.length>0)).map((e=>e.split("="))).forEach((([e,t])=>{this.ghostValues[e]=t}))}return this.ghostValues}static async fromSource(e,t,i){const r=(await e.fetch([{offset:0,length:1024}],i))[0],s=new Re(r),n=s.getUint16(0,0);let o;if(18761===n)o=!0;else{if(19789!==n)throw new TypeError("Invalid byte order value.");o=!1}const a=s.getUint16(2,o);let l;if(42===a)l=!1;else{if(43!==a)throw new TypeError("Invalid magic number.");if(l=!0,8!==s.getUint16(4,o))throw new Error("Unsupported offset byte-size.")}const h=l?s.getUint64(8,o):s.getUint32(4,o);return new yt(e,o,l,h,t)}close(){return"function"==typeof this.source.close&&this.source.close()}}class wt extends pt{constructor(e,t){super(),this.mainFile=e,this.overviewFiles=t,this.imageFiles=[e].concat(t),this.fileDirectoriesPerFile=null,this.fileDirectoriesPerFileParsing=null,this.imageCount=null}async parseFileDirectoriesPerFile(){const e=[this.mainFile.parseFileDirectoryAt(this.mainFile.firstIFDOffset)].concat(this.overviewFiles.map((e=>e.parseFileDirectoryAt(e.firstIFDOffset))));return this.fileDirectoriesPerFile=await Promise.all(e),this.fileDirectoriesPerFile}async getImage(e=0){await this.getImageCount(),await this.parseFileDirectoriesPerFile();let t=0,i=0;for(let r=0;r<this.imageFiles.length;r++){const s=this.imageFiles[r];for(let n=0;n<this.imageCounts[r];n++){if(e===t){const e=await s.requestIFD(i);return new Ge(e.fileDirectory,e.geoKeyDirectory,s.dataView,s.littleEndian,s.cache,s.source)}t++,i++}i=0}throw new RangeError("Invalid image index")}async getImageCount(){if(null!==this.imageCount)return this.imageCount;const e=[this.mainFile.getImageCount()].concat(this.overviewFiles.map((e=>e.getImageCount())));return this.imageCounts=await Promise.all(e),this.imageCount=this.imageCounts.reduce(((e,t)=>e+t),0),this.imageCount}}var mt=i(6414),bt=i(3983),St=i(8641),At=i(8375);function It(e,t){if(!e)return!1;if(!0===e)return!0;if(3!==t.getSamplesPerPixel())return!1;const i=t.fileDirectory.PhotometricInterpretation,r=y.Ie;return i===r.CMYK||i===r.YCbCr||i===r.CIELab||i===r.ICCLab}const vt="STATISTICS_MAXIMUM",Tt="STATISTICS_MINIMUM";let xt;function Dt(){return xt||(xt=new A),xt}function Et(e){try{return e.getBoundingBox()}catch(t){const i=e.fileDirectory;return[0,0,i.ImageWidth,i.ImageLength]}}function _t(e){try{return e.getOrigin().slice(0,2)}catch(t){return[0,e.fileDirectory.ImageLength]}}function Pt(e,t){try{return e.getResolution(t)}catch(i){return[t.fileDirectory.ImageWidth/e.fileDirectory.ImageWidth,t.fileDirectory.ImageHeight/e.fileDirectory.ImageHeight]}}function Ct(e){const t=e.geoKeys;if(!t)return null;if(t.ProjectedCSTypeGeoKey){const e="EPSG:"+t.ProjectedCSTypeGeoKey;let i=(0,mt.U2)(e);if(!i){const r=(0,At.N)(t.ProjLinearUnitsGeoKey);r&&(i=new mt.kv({code:e,units:r}))}return i}if(t.GeographicTypeGeoKey){const e="EPSG:"+t.GeographicTypeGeoKey;let i=(0,mt.U2)(e);if(!i){const r=(0,At.N)(t.GeogAngularUnitsGeoKey);r&&(i=new mt.kv({code:e,units:r}))}return i}return null}function Mt(e){return e.getImageCount().then((function(t){const i=new Array(t);for(let r=0;r<t;++r)i[r]=e.getImage(r);return Promise.all(i)}))}function kt(e,t){let i;return i=e.blob?async function(e,t){return yt.fromSource(new ct(e),t)}(e.blob):e.overviews?async function(e,t=[],i={},r){const s=await yt.fromSource(ht(e,i),r),n=await Promise.all(t.map((e=>yt.fromSource(ht(e,i)))));return new wt(s,n)}(e.url,e.overviews,t):async function(e,t={},i){return yt.fromSource(ht(e,t),i)}(e.url,t),i.then(Mt)}function Ft(e,t,i,r,s){if(Array.isArray(e)){const n=e.length;if(!Array.isArray(t)||n!=t.length){const e=new Error(r);throw s(e),e}for(let o=0;o<n;++o)Ft(e[o],t[o],i,r,s)}else if(Math.abs(e-t)>i*e)throw new Error(r)}function Gt(e){return e instanceof Int8Array?127:e instanceof Uint8Array||e instanceof Uint8ClampedArray?255:e instanceof Int16Array?32767:e instanceof Uint16Array?65535:e instanceof Int32Array?2147483647:e instanceof Uint32Array?4294967295:e instanceof Float32Array?34e37:255}class Rt extends d{constructor(e){super({state:"loading",tileGrid:null,projection:null,opaque:e.opaque,transition:e.transition,interpolate:!1!==e.interpolate,wrapX:e.wrapX}),this.sourceInfo_=e.sources;const t=this.sourceInfo_.length;this.sourceOptions_=e.sourceOptions,this.sourceImagery_=new Array(t),this.sourceMasks_=new Array(t),this.resolutionFactors_=new Array(t),this.samplesPerPixel_,this.nodataValues_,this.metadata_,this.normalize_=!1!==e.normalize,this.addAlpha_=!1,this.error_=null,this.convertToRGB_=e.convertToRGB||!1,this.setKey(this.sourceInfo_.map((e=>e.url)).join(","));const i=this,r=new Array(t);for(let e=0;e<t;++e)r[e]=kt(this.sourceInfo_[e],this.sourceOptions_);Promise.all(r).then((function(e){i.configure_(e)})).catch((function(e){console.error(e),i.error_=e,i.setState("error")}))}getError(){return this.error_}configure_(e){let t,i,r,s,n;const o=new Array(e.length),a=new Array(e.length),l=new Array(e.length);let h=0;const c=e.length;for(let u=0;u<c;++u){const c=[],f=[];e[u].forEach((e=>{4==(4&(e.fileDirectory.NewSubfileType||0))?f.push(e):c.push(e)}));const g=c.length;if(f.length>0&&f.length!==g)throw new Error(`Expected one mask per image found ${f.length} masks and ${g} images`);let d,p;const y=new Array(g),w=new Array(g),m=new Array(g);a[u]=new Array(g),l[u]=new Array(g);for(let e=0;e<g;++e){const t=c[e],i=t.getGDALNoData();l[u][e]=t.getGDALMetadata(0),a[u][e]=i;const r=this.sourceInfo_[u].bands;o[u]=r?r.length:t.getSamplesPerPixel();const s=g-(e+1);d||(d=Et(t)),p||(p=_t(t));const n=Pt(t,c[0]);m[s]=n[0];const h=[t.getTileWidth(),t.getTileHeight()];y[s]=h;const f=n[0]/Math.abs(n[1]);w[s]=[h[0],h[1]/f]}if(t?(0,St.Ed)(t,d,t):t=d,i?Ft(i,p,0,`Origin mismatch for source ${u}, got [${p}] but expected [${i}]`,this.viewRejector):i=p,n){n.length-h>m.length&&(h=n.length-m.length);const e=n[n.length-1]/m[m.length-1];this.resolutionFactors_[u]=e;const t=m.map((t=>t*e)),i=`Resolution mismatch for source ${u}, got [${t}] but expected [${n}]`;Ft(n.slice(h,n.length),t,.02,i,this.viewRejector)}else n=m,this.resolutionFactors_[u]=1;r?Ft(r.slice(h,r.length),w,.01,`Tile size mismatch for source ${u}`,this.viewRejector):r=w,s?Ft(s.slice(h,s.length),y,0,`Tile size mismatch for source ${u}`,this.viewRejector):s=y,this.sourceImagery_[u]=c.reverse(),this.sourceMasks_[u]=f.reverse()}for(let e=0,t=this.sourceImagery_.length;e<t;++e){const t=this.sourceImagery_[e];for(;t.length<n.length;)t.unshift(void 0)}if(!this.getProjection()){const t=e[0];for(let e=t.length-1;e>=0;--e){const i=Ct(t[e]);if(i){this.projection=i;break}}}this.samplesPerPixel_=o,this.nodataValues_=a,this.metadata_=l;e:for(let e=0;e<c;++e){if(void 0!==this.sourceInfo_[e].nodata){this.addAlpha_=!0;break}if(this.sourceMasks_[e].length){this.addAlpha_=!0;break}const t=a[e],i=this.sourceInfo_[e].bands;if(i){for(let e=0;e<i.length;++e)if(null!==t[i[e]-1]){this.addAlpha_=!0;break e}}else for(let e=0;e<t.length;++e)if(null!==t[e]){this.addAlpha_=!0;break e}}let u=this.addAlpha_?1:0;for(let e=0;e<c;++e)u+=o[e];this.bandCount=u;const f=new p.Z({extent:t,minZoom:h,origin:i,resolutions:n,tileSizes:r});this.tileGrid=f,this.setTileSizes(s),this.setLoader(this.loadTile_.bind(this)),this.setState("ready");let g=0;1===n.length&&(n=[2*n[0],n[0]],g=1),this.viewResolver({showFullExtent:!0,projection:this.projection,resolutions:n,center:(0,mt.lO)((0,St.qg)(t),this.projection),extent:(0,mt.Fj)(t,this.projection),zoom:g})}loadTile_(e,t,i){const r=this.getTileSize(e),s=this.sourceImagery_.length,n=new Array(2*s),o=this.nodataValues_,a=this.sourceInfo_,l=Dt();for(let h=0;h<s;++h){const c=a[h],u=this.resolutionFactors_[h],f=[Math.round(t*(r[0]*u)),Math.round(i*(r[1]*u)),Math.round((t+1)*(r[0]*u)),Math.round((i+1)*(r[1]*u))],g=this.sourceImagery_[h][e];let d,p;c.bands&&(d=c.bands.map((function(e){return e-1}))),p="nodata"in c&&null!==c.nodata?c.nodata:d?d.map((function(e){return o[h][e]})):o[h];const y={window:f,width:r[0],height:r[1],samples:d,fillValue:p,pool:l,interleave:!1};It(this.convertToRGB_,g)?n[h]=g.readRGB(y):n[h]=g.readRasters(y);const w=s+h,m=this.sourceMasks_[h][e];n[w]=m?m.readRasters({window:f,width:r[0],height:r[1],samples:[0],pool:l,interleave:!1}):Promise.resolve(null)}return Promise.all(n).then(this.composeTile_.bind(this,r)).catch((function(e){throw console.error(e),e}))}composeTile_(e,t){const i=this.metadata_,r=this.sourceInfo_,s=this.sourceImagery_.length,n=this.bandCount,o=this.samplesPerPixel_,a=this.nodataValues_,l=this.normalize_,h=this.addAlpha_,c=e[0]*e[1],u=c*n;let f;f=l?new Uint8Array(u):new Float32Array(u);let g=0;for(let e=0;e<c;++e){let n=h;for(let c=0;c<s;++c){const u=r[c];let p,y,w=u.min,m=u.max;if(l){const e=i[c][0];void 0===w&&(w=e&&Tt in e?parseFloat(e[Tt]):(d=t[c][0])instanceof Int8Array?-128:d instanceof Int16Array?-32768:d instanceof Int32Array?-2147483648:d instanceof Float32Array?12e-39:0),void 0===m&&(m=e&&vt in e?parseFloat(e[vt]):Gt(t[c][0])),p=255/(m-w),y=-w*p}for(let i=0;i<o[c];++i){const r=t[c][i][e];let s;if(s=l?(0,bt.uZ)(p*r+y,0,255):r,h){let e=u.nodata;if(void 0===e){let t;t=u.bands?u.bands[i]-1:i,e=a[c][t]}const t=isNaN(e);(!t&&r!==e||t&&!isNaN(r))&&(n=!1,f[g]=s)}else f[g]=s;g++}if(!n){const i=t[s+c];i&&!i[0][e]&&(n=!0)}}h&&(n||(f[g]=255),g++)}var d;return f}}Rt.prototype.getView;const Ot=Rt}}]);